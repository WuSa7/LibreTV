name: 自动同步上游仓库更新
on:
  # 1. 定时触发（每天凌晨2点同步，可修改 cron 表达式）
  schedule:
    - cron: '0 2 * * *'  # cron 格式：分 时 日 月 周（UTC时间，国内需+8小时）
  # 2. 手动触发（可在 Actions 页面手动点击运行）
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      # 步骤1：拉取你的 fork 仓库代码到运行环境
      - name: 检出代码
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 拉取所有历史提交（避免合并冲突）

      # 步骤2：配置 Git 身份（用于提交同步记录）
      - name: 配置 Git 信息
        run: |
          git config --global user.name "你的 GitHub 用户名"
          git config --global user.email "你的 GitHub 绑定邮箱"

      # 步骤3：添加上游仓库并拉取更新
      - name: 同步上游仓库
        run: |
          # 替换为原仓库的 URL（上游仓库地址）
          git remote add upstream https://github.com/LibreSpark/LibreTV.git
          git fetch upstream
          # 替换为需要同步的分支（通常是 main 或 master）
          git checkout main
          git merge upstream/main --allow-unrelated-histories  # 允许无关联历史合并（首次同步可能需要）

      # 步骤4：推送更新到你的 fork 仓库
      - name: 推送同步结果
        uses: ad-m/github-push-action@master
        with:
          branch: main  # 与上面的分支名保持一致
          github_token: ${{ secrets.GITHUB_TOKEN }}  # GitHub 自动生成的令牌，无需手动配置
